#!/usr/bin/env ruby
lib = File.dirname(__FILE__) + '/../lib'
$:.unshift lib unless $:.include? lib

require 'cuukie/cli'

at_exit do
  require 'rest-client'
  begin
    RestClient.delete 'http://localhost:4569'
  rescue; end
end

Process.detach(fork do
  exec "ruby #{File.dirname(__FILE__)}/cuukie_server >/dev/null 2>&1"
end)

puts 'View your features at http://localhost:4569'

system "cucumber #{ARGV.join(' ')} --format cuukie"

puts 'All features checked. Press a key to exit.'
gets if options[:wait]
